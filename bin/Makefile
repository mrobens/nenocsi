#####################################################################################
# Noxim - the NoC Simulator
#
# Copyright (C) 2005-2018 by the University of Catania
# For the complete list of authors refer to file ../doc/AUTHORS.txt
# For the license applied to these sources refer to file ../doc/LICENSE.txt
#
#************************************************************************************
# Downloaded March 23, 2022 from
# https://github.com/davidepatti/noxim/tree/c52ebce2217e57bcd4ff11a97b400323bd00acd5
#************************************************************************************
#
# NENoCSi: Patched version of Noxim to process traffic generated by NEST
# Modifications Copyright (C) 2022-2023 Forschungszentrum Juelich GmbH, ZEA-2
# Author: Markus Robens <https://www.fz-juelich.de/profile/robens_m>
# For the license applied to these modifications and NENoCSi as a whole
# refer to file ../doc/LICENSE_NENOCSI.txt
#  
# 2023-01-31: According to the installation instructions in ../doc/INSTALL.txt,
#             system libraries of SystemC and YAML-CPP are used. Thus, there is no
#             need to configure library paths and according entries have been removed
#             compared to the original Makefile. Also some command line switches have
#             been simplified, accordingly.
#
##### DIRECTORIES ###################################################################

SRCDIR  := ../src
SUBDIRS := $(filter %/,$(wildcard $(SRCDIR)/*/))
OBJDIR  := ./build

SRCS := $(wildcard $(SRCDIR)/*.cpp) $(wildcard $(addsuffix *.cpp,$(SUBDIRS)))
OBJS := $(subst $(SRCDIR),$(OBJDIR),$(SRCS:.cpp=.o))

MODULE := nenocsi

##### COMPILER OPTIONS ##############################################################

CXX      := g++
OPT      := -O3
# to enable logs with LOG macro, uncomment "-g -DDEBUG" in the line below
# and recompile everythin (make clean)
#DEBUG    :=  -g -DDEBUG
OTHER    := -Wall -DSC_NO_WRITE_CHECK 
CXXFLAGS := $(OPT) $(OTHER) $(DEBUG)

INCDIR := -I$(SRCDIR) 

# MR: Added -lboost_filesystem 2022/04/04
LIBS := -lboost_filesystem -lsystemc -lm -lyaml-cpp

SPACE := $(subst ,, )
VPATH := $(SRCDIR):$(subst $(SPACE),:,$(SUBDIRS))

##### RULES #########################################################################

$(MODULE): $(OBJS)
	$(CXX) $^ $(LIBS) -o $@ 2>&1 | c++filt

$(OBJDIR)/%.o: %.cpp
	@mkdir -p $(dir $@)
	$(CXX) $(CXXFLAGS) $(INCDIR) -c $< -o $@

clean:
	rm -f $(OBJS) $(MODULE) *~

depend: 
	makedepend $(SRCS) -Y -f- 2>/dev/null | sed 's_$(SRCDIR)_$(OBJDIR)_' > Makefile.deps

-include Makefile.deps
